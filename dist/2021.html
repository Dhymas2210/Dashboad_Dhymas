<!DOCTYPE html>
<html lang="id">
<head>
  <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" rel="stylesheet">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Hasil Pemodelan CO - DKI Jakarta</title>
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" />
  <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map { height: 75vh; border-radius: 15px; box-shadow: 0 0 15px rgba(0,0,0,0.2); margin-top: 15px; position: relative; }
    .panel { background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    h3.panel-title { text-align: center; font-weight: bold; margin-bottom: 15px; color: #333; }
    .logo-stis { height: 60px; margin-right: 15px; }
    .judul-header { font-size: 1.5rem; font-weight: bold; color: white; }
    .info.legend { background: white; padding: 8px; line-height: 1.4; border-radius: 8px; font-size: 12px; box-shadow: 0 0 5px rgba(0,0,0,0.3); }
    .info.legend i { width: 12px; height: 12px; float: left; margin-right: 8px; opacity: 0.8; }
    .info.variables-toggle, .info.explainer-toggle {
      position: absolute;
      top: 70px;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      font-size: 13px;
      max-width: 250px;
      display: none;
      z-index: 1000;
    }
    .info.variables-toggle { right: 10px; }
    .info.explainer-toggle { left: 10px; }
    .info-toggle-btn { position: absolute; top: 10px; z-index: 1001; }
    .toggle-left { left: 10px; }
    .toggle-right { right: 10px; }
    #kategoriFilter { margin-bottom: 10px; }

    .dt-buttons {
  margin-left: 10px;
}

  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
    <div class="container">
      <div class="navbar-brand d-flex align-items-center">
        <img src="assets/img/logi.png" alt="" class="logo-stis">
        <span class="judul-header">SPASIAL CO JAKARTA</span>
      </div>
      <button class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive">
        Menu <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="index.html#permasalahan">Permasalahan</a></li>
          <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="index.html#tujuan">Tujuan</a></li>
          <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="index.html#ruanglingkup">Ruang Lingkup</a></li>
          <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="index.html#manfaat">Manfaat</a></li>
          <a class="nav-link dropdown-toggle py-3 px-0 px-lg-3 rounded" href="index.html" role="button" data-bs-toggle="dropdown" aria-expanded="false">Hasil Pemodelan</a>
          <ul class="dropdown-menu dropdown-menu-end text-center">
            <li><a class="dropdown-item" href="2020.html">Tahun 2020</a></li>
            <li><a class="dropdown-item" href="2021.html">Tahun 2021</a></li>
            <li><a class="dropdown-item" href="2022.html">Tahun 2022</a></li>
            <li><a class="dropdown-item" href="2023.html">Tahun 2023</a></li>
            <li><a class="dropdown-item" href="2024.html">Tahun 2024</a></li>
          </ul>
        </ul>
      </div>
    </div>
  </nav>

  <header class="masthead bg-primary text-white text-center">
    <div class="container d-flex align-items-center flex-column">
      <h2 class="masthead-heading text-mb-0">Hasil Pemodelan Konsentrasi CO</h2>
      <p class="masthead-subheading font-weight-light mb-0">Provinsi DKI Jakarta | Tahun 2021</p>
    </div>
  </header>

  <div class="container mt-4">
    <div class="panel">
      <h3 class="panel-title">Peta Titik Konsentrasi CO</h3>
      <label for="kategoriFilter">Filter Kategori Aktivitas:</label>
      <select id="kategoriFilter" class="form-select mb-2">
        <option value="">Semua</option>
        <option value="Perjalanan dan Transportasi">Perjalanan dan Transportasi</option>
        <option value="Tempat Tinggal">Tempat Tinggal</option>
        <option value="Perguruan Tinggi dan Universitas">Perguruan Tinggi dan Universitas</option>
        <option value="Acara">Acara</option>
        <option value="Hiburan Malam">Hiburan Malam</option>
        <option value="Luar Ruangan dan Rekreasi">Luar Ruangan dan Rekreasi</option>
        <option value="Makanan">Makanan</option>
        <option value="Seni dan Hiburan">Seni dan Hiburan</option>
        <option value="Tempat Profesional dan Lainnya">Tempat Profesional dan Lainnya</option>
        <option value="Toko dan Layanan">Toko dan Layanan</option>
      </select>
      <div id="map">
        <button class="btn btn-secondary info-toggle-btn toggle-left" onclick="toggleExplainer()">Keterangan Variabel</button>
        <div class="info explainer-toggle" id="explainerInfo">
          <strong>Keterangan Variabel:</strong><br>
          X1: Kepadatan Penduduk<br>
          X2: Ketinggian Wilayah<br>
          X3: NDBI<br>
          X4: NDVI<br>
          X5: Kecepatan Angin<br>
          X6: Suhu Udara<br>
          X7: Kelembaban Relatif Udara<br>
          X8: Curah Hujan<br>
          X9: Tekanan Atmosfer<br>
          X10: Dummy COVID-19
        </div>
      </div>
    </div>

    <div class="panel">
      <h3 class="panel-title">Data Hasil Pemodelan</h3>
      <div style="overflow-x: auto;">
        <table id="dataModelTable" class="display nowrap" style="width:100%"></table>
      </div>
    </div>
  </div>


  <footer class="footer text-center">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <h4 class="text-uppercase mb-4">Tentang Website Ini</h4>
          <p class="lead mb-0">
            Website ini menyajikan hasil pemodelan spasial dan temporal konsentrasi karbon monoksida (CO) di DKI Jakarta menggunakan pendekatan Point of Interest pada tahun 2021.
          </p>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    function toggleVariables() {
      const infoBox = document.getElementById('variableInfo');
      infoBox.style.display = infoBox.style.display === 'block' ? 'none' : 'block';
    }
    function toggleExplainer() {
      const infoBox = document.getElementById('explainerInfo');
      infoBox.style.display = infoBox.style.display === 'block' ? 'none' : 'block';
    }
  </script>

  <script>
  function fillTabelModel(data) {
  if ($.fn.DataTable.isDataTable('#dataModelTable')) {
    $('#dataModelTable').DataTable().clear().destroy();
    $('#dataModelTable').empty(); // kosongkan header agar bisa bikin ulang
  }

  $('#dataModelTable').DataTable({
    data,
    destroy: true,
    dom: 'Bfrtip',
    buttons: [
      {
        extend: 'copyHtml5',
        className: 'btn btn-sm btn-secondary',
        title: 'Data Hasil Pemodelan CO'
      },
      {
        extend: 'csvHtml5',
        className: 'btn btn-sm btn-secondary',
        title: 'Data Hasil Pemodelan CO'
      },
      {
        extend: 'excelHtml5',
        className: 'btn btn-sm btn-success',
        title: 'Data Hasil Pemodelan CO'
      },
      {
        extend: 'pdfHtml5',
        className: 'btn btn-sm btn-danger',
        title: 'Data Hasil Pemodelan CO'
      }
    ],
    columns: [
      { title: 'Link', data: 'link', render: data => `<a href="${data}" target="_blank">Lihat</a>` },
      { title: 'Title', data: 'title' },
      { title: 'Kategori', data: 'Kategori Aktivitas Utama' },
      { title: 'Intercept', data: 'Intercept' },
      { title: 'Model Kepadatan', data: 'Model_Kepadatan' },
      { title: 'Model Ketinggian', data: 'Model_Ketinggian' },
      { title: 'Model NDBI', data: 'Model_NDBI' },
      { title: 'Model NDVI', data: 'Model_NDVI' },
      { title: 'Model Kecepatan Angin', data: 'Model_KecepatanAngin' },
      { title: 'Model RH', data: 'Model_RH' },
      { title: 'Model Suhu', data: 'Model_Suhu' },
      { title: 'Model Curah Hujan', data: 'Model_CurahHujan' },
      { title: 'Model Tekanan Atmosfer', data: 'Model_TekananAtmosfer' },
      { title: 'Model Covid', data: 'Model_Covid' },
      { title: 'Local R2', data: 'Local_R2' },
      { title: 'Signif Vars', data: 'signif_vars' }
    ]
  });
}

  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js"></script>
  <script>
    let signifColorMap = {};
    let geojsonLayer;
    let allFeatures = [];
    let legend;

    const map = L.map('map').setView([-6.2, 106.8], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    fetch('Data_Dhymas.geojson')
      .then(res => res.json())
      .then(data => {
        allFeatures = data.features.filter(f => f.properties.Tahun == 2021);
        generateSignifColorMap(allFeatures);
        updateMap();
      });

    function generateSignifColorMap(features) {
      const uniqueVars = [...new Set(features.map(f => f.properties['signif_vars']))].sort();
      const colors = chroma.scale('Spectral').mode('lch').colors(uniqueVars.length);
      signifColorMap = {};
      uniqueVars.forEach((v, i) => signifColorMap[v] = colors[i]);
    }

    function getColorBySignifVars(val) {
      return signifColorMap[val] || '#999';
    }

    function updateMap() {
      if (geojsonLayer) map.removeLayer(geojsonLayer);
      if (legend) map.removeControl(legend);

      const kategori = document.getElementById('kategoriFilter').value;
      const filtered = allFeatures.filter(f => !kategori || f.properties["Kategori Aktivitas Utama"] === kategori);

      generateSignifColorMap(filtered);

      geojsonLayer = L.geoJSON({ type: 'FeatureCollection', features: filtered }, {
        onEachFeature: function (feature, layer) {
          const props = feature.properties;
          const popupContent = `
            <b>${props.title}</b><br>
            Kategori: ${props["Kategori Aktivitas Utama"]}<br>
            Signif Vars: ${props.signif_vars}<br>
            <a href='${props.link}' target='_blank'>Lihat di Gmaps</a>
          `;
          layer.bindPopup(popupContent);
        },
        pointToLayer: (f, latlng) => L.circleMarker(latlng, {
          radius: 6,
          fillColor: getColorBySignifVars(f.properties['signif_vars']),
          color: '#000',
          weight: 1,
          opacity: 1,
          fillOpacity: 0.8
        })
      }).addTo(map);

      fillTabelAwal(filtered.map(f => f.properties));
      fillTabelModel(filtered.map(f => f.properties));

      legend = L.control({ position: 'bottomright' });
      legend.onAdd = function () {
        const div = L.DomUtil.create("div", "info legend");
        const keys = Object.keys(signifColorMap);
        div.innerHTML = keys.map(k => `<i style="background:${signifColorMap[k]}"></i> ${k}`).join("<br>");
        return div;
      };
      legend.addTo(map);
    }

    document.getElementById('kategoriFilter').addEventListener('change', updateMap);

    function fillTabelAwal(data) {
      $('#dataAwalTable').DataTable({
        destroy: true,
        data,
        columns: [
          { title: 'Link', data: 'link', render: data => `<a href="${data}" target="_blank">Lihat</a>` },
          { title: 'Title', data: 'title' },
          { title: 'Kecamatan', data: 'Kecamatan' },
          { title: 'Kelurahan', data: 'Kelurahan' },
          { title: 'Kota', data: 'Kota' },
          { title: 'Kategori', data: 'Kategori Aktivitas Utama' },
          { title: 'Tahun', data: 'Tahun' },
          { title: 'Kepadatan Penduduk', data: 'Kepadatan Penduduk' },
          { title: 'Ketinggian', data: 'Ketinggian Wilayah' },
          { title: 'CO', data: 'CO' },
          { title: 'NDBI', data: 'NDBI' },
          { title: 'NDVI', data: 'NDVI' },
          { title: 'Curah Hujan', data: 'Curah Hujan' },
          { title: 'Suhu', data: 'Suhu' },
          { title: 'Kecepatan Angin', data: 'Kecepatan Angin' },
          { title: 'RH', data: 'RH' },
          { title: 'Tekanan Atmosfer', data: 'Tekanan Atmosfer' }
        ]
      });
    }

    function fillTabelModel(data) {
      $('#dataModelTable').DataTable({
        destroy: true,
        data,
        columns: [
          { title: 'Link', data: 'link', render: data => `<a href="${data}" target="_blank">Lihat</a>` },
          { title: 'Title', data: 'title' },
          { title: 'Kategori', data: 'Kategori Aktivitas Utama' },
          { title: 'Intercept', data: 'Intercept' },
          { title: 'Model Kepadatan', data: 'Model_Kepadatan' },
          { title: 'Model Ketinggian', data: 'Model_Ketinggian' },
          { title: 'Model NDBI', data: 'Model_NDBI' },
          { title: 'Model NDVI', data: 'Model_NDVI' },
          { title: 'Model Kecepatan Angin', data: 'Model_KecepatanAngin' },
          { title: 'Model RH', data: 'Model_RH' },
          { title: 'Model Suhu', data: 'Model_Suhu' },
          { title: 'Model Curah Hujan', data: 'Model_CurahHujan' },
          { title: 'Model Tekanan Atmosfer', data: 'Model_TekananAtmosfer' },
          { title: 'Model Covid', data: 'Model_Covid' },
          { title: 'Local R2', data: 'Local_R2' },
          { title: 'Signif Vars', data: 'signif_vars' }
        ]
      });
    }
  </script>


</body>
</html>
